generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String          @id @default(uuid())
  name             String
  email            String          @unique
  role             Role            @default(MEMBER)
  avatarUrl        String?
  createdAt        DateTime        @default(now())
  feedbackGiven    Feedback[]      @relation("FeedbackGiven")
  feedbackReceived Feedback[]      @relation("FeedbackReceived")
  githubProfile    GitHubData?
  googleProfile    GoogleDocsData?
  messages         Message[]
  projectsCreated  Project[]       @relation("ProjectsCreated")
  projects         ProjectMember[]
  tasksAssigned    Task[]          @relation("AssignedTasks")
  tasksCreated     Task[]          @relation("CreatedTasks")
}

model Project {
  id          String          @id @default(uuid())
  name        String
  description String?
  createdById String
  createdAt   DateTime        @default(now())
  feedbacks   Feedback[]
  insights    Insight[]
  messages    Message[]
  createdBy   User            @relation("ProjectsCreated", fields: [createdById], references: [id])
  members     ProjectMember[]
  tasks       Task[]

  @@index([createdById])
  @@index([createdAt])
}

model ProjectMember {
  id        String   @id @default(uuid())
  userId    String
  projectId String
  role      Role     @default(MEMBER)
  joinedAt  DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([projectId])
  @@index([userId])
}

model Task {
  id             String     @id @default(uuid())
  title          String
  description    String?
  weight         Float      @default(1.0)
  status         TaskStatus @default(PENDING)
  projectId      String
  createdById    String
  assignedToId   String?
  completionTime Int?
  peerScore      Float?
  aiScore        Float?
  createdAt      DateTime   @default(now())
  assignedTo     User?      @relation("AssignedTasks", fields: [assignedToId], references: [id])
  createdBy      User       @relation("CreatedTasks", fields: [createdById], references: [id])
  project        Project    @relation(fields: [projectId], references: [id])
}

model Message {
  id        String   @id @default(uuid())
  content   String
  senderId  String
  projectId String
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id])
  sender    User     @relation(fields: [senderId], references: [id])
}

model GitHubData {
  id           String    @id @default(uuid())
  userId       String    @unique
  commits      Int?      @default(0)
  pullRequests Int?      @default(0)
  linesOfCode  Int?      @default(0)
  lastSync     DateTime?
  user         User      @relation(fields: [userId], references: [id])
}

model GoogleDocsData {
  id           String    @id @default(uuid())
  userId       String    @unique
  editsCount   Int?      @default(0)
  lastActivity DateTime?
  user         User      @relation(fields: [userId], references: [id])
}

model Insight {
  id        String   @id @default(uuid())
  projectId String
  content   String
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id])
}

model Feedback {
  id         String   @id @default(uuid())
  fromUserId String
  toUserId   String
  projectId  String
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
  fromUser   User     @relation("FeedbackGiven", fields: [fromUserId], references: [id])
  project    Project  @relation(fields: [projectId], references: [id])
  toUser     User     @relation("FeedbackReceived", fields: [toUserId], references: [id])
}

enum Role {
  LEADER
  MEMBER
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}
